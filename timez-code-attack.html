<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Timez Code Attack</title>
<style>
:root{
  --bg:#0b1016;
  --hud:#0f1725;
  --panel:#141f2f;
  --panel-2:#0f1a2a;
  --line:#23324a;
  --glow:#2dd4bf;
  --accent:#f97316;
  --accent-2:#fbbf24;
  --good:#22c55e;
  --bad:#f87171;
  --text:#e2e8f0;
  --muted:#94a3b8;
}
*{box-sizing:border-box}
body{
  margin:0;
  min-height:100vh;
  background:
    radial-gradient(circle at 15% 10%, rgba(34,197,94,0.16), transparent 45%),
    radial-gradient(circle at 80% 20%, rgba(249,115,22,0.2), transparent 40%),
    linear-gradient(135deg, #0b1016 10%, #070b10 100%);
  color:var(--text);
  font-family:"Trebuchet MS","Lucida Sans",Tahoma,sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:22px;
}
.shell{
  width:1200px;
  max-width:96vw;
  min-height:86vh;
  background:var(--hud);
  border:1px solid var(--line);
  border-radius:16px;
  display:grid;
  grid-template-columns: 320px 1fr;
  overflow:hidden;
  box-shadow:0 24px 70px rgba(2,8,23,0.5);
  animation:rise .8s ease both;
}
@keyframes rise{from{opacity:0;transform:translateY(18px) scale(0.98)}to{opacity:1;transform:translateY(0) scale(1)}}
.sidebar{
  padding:18px;
  background:linear-gradient(180deg, #0f1a2a 0%, #0c131e 100%);
  border-right:1px solid var(--line);
  display:flex;
  flex-direction:column;
  gap:14px;
}
.title{
  font-family:"Impact","Haettenschweiler","Arial Black",sans-serif;
  letter-spacing:1px;
  font-size:28px;
  margin:0;
  color:var(--accent-2);
}
.subtitle{
  font-size:13px;
  color:var(--muted);
}
.panel{
  background:var(--panel);
  border:1px solid var(--line);
  border-radius:12px;
  padding:12px;
  animation:panelPop .7s ease both;
}
.panel:nth-of-type(2){animation-delay:.08s}
.panel:nth-of-type(3){animation-delay:.14s}
.panel:nth-of-type(4){animation-delay:.2s}
@keyframes panelPop{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.stat{
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:14px;
  margin-bottom:8px;
}
.badge{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:6px 8px;
  background:var(--panel-2);
  border:1px solid var(--line);
  border-radius:999px;
  font-size:12px;
}
.badge span{color:var(--accent)}
.controls{
  font-size:12px;
  color:var(--muted);
  line-height:1.5;
}
.button{
  border:none;
  cursor:pointer;
  padding:10px 12px;
  border-radius:10px;
  font-weight:700;
  background:linear-gradient(135deg, var(--accent) 0%, var(--accent-2) 100%);
  color:#241100;
  box-shadow:0 10px 20px rgba(249,115,22,0.22);
}
.button.secondary{
  background:transparent;
  border:1px solid var(--line);
  color:var(--text);
  box-shadow:none;
}
.stack{display:flex;gap:10px;flex-wrap:wrap}
.game{
  position:relative;
  display:flex;
  flex-direction:column;
  background:radial-gradient(circle at 80% 20%, rgba(45,212,191,0.15), transparent 40%);
}
.canvasWrap{
  position:relative;
  flex:1;
  background:linear-gradient(180deg, rgba(15,23,42,0.8), rgba(2,6,23,0.9));
}
canvas{
  width:100%;
  height:100%;
  display:block;
}
.hudTop{
  position:absolute;
  top:12px;
  left:12px;
  display:flex;
  gap:10px;
  align-items:center;
}
.chip{
  background:rgba(15,23,42,0.8);
  border:1px solid var(--line);
  border-radius:999px;
  padding:6px 10px;
  font-size:12px;
}
.crosshair{
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  width:22px;
  height:22px;
  border:2px solid rgba(226,232,240,0.7);
  border-radius:50%;
  box-shadow:0 0 18px rgba(45,212,191,0.4);
}
.overlay{
  position:absolute;
  inset:0;
  background:rgba(3,7,18,0.7);
  display:flex;
  justify-content:center;
  align-items:center;
  padding:18px;
  opacity:0;
  pointer-events:none;
  transition:opacity .2s ease;
}
.overlay.show{opacity:1;pointer-events:auto}
.modal{
  width:min(680px,90vw);
  background:var(--panel);
  border:1px solid var(--line);
  border-radius:14px;
  padding:16px;
  box-shadow:0 30px 80px rgba(2,8,23,0.6);
  animation:modalPop .25s ease;
}
@keyframes modalPop{from{transform:scale(0.96);opacity:0}to{transform:scale(1);opacity:1}}
.modal h2{
  margin:0 0 8px;
  font-size:20px;
  font-family:"Impact","Haettenschweiler","Arial Black",sans-serif;
  letter-spacing:.6px;
  color:var(--glow);
}
.prompt{
  font-size:14px;
  color:var(--text);
  margin-bottom:10px;
}
.code{
  background:#0b1120;
  border:1px solid #22324a;
  border-radius:10px;
  padding:10px;
  font-family:"SFMono-Regular",Menlo,Consolas,monospace;
  font-size:13px;
  white-space:pre-wrap;
  color:#e2e8f0;
}
.answers{
  display:grid;
  gap:8px;
  margin-top:12px;
}
.answer{
  background:#0d1525;
  border:1px solid var(--line);
  border-radius:10px;
  padding:10px;
  text-align:left;
  color:var(--text);
  cursor:pointer;
}
.answer:hover{border-color:var(--glow)}
.answer.correct{border-color:rgba(34,197,94,0.8);background:rgba(34,197,94,0.1)}
.answer.wrong{border-color:rgba(248,113,113,0.8);background:rgba(248,113,113,0.1)}
.status{
  font-size:13px;
  color:var(--muted);
  margin-top:10px;
}
.footer{
  padding:10px 16px;
  border-top:1px solid var(--line);
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:12px;
  color:var(--muted);
}
.footer strong{color:var(--accent-2)}
.win{
  font-size:18px;
  color:var(--good);
  font-weight:800;
}
@media (max-width: 980px){
  .shell{grid-template-columns:1fr}
  .sidebar{order:2}
}
</style>
</head>
<body>
<div class="shell">
  <aside class="sidebar">
    <div>
      <h1 class="title">Timez Code Attack</h1>
      <div class="subtitle">Race through a neon vault, hack terminals, and unlock the portal by solving coding challenges.</div>
    </div>
    <div class="panel">
      <div class="stat"><div>Time Shards</div><div id="shards">0 / 3</div></div>
      <div class="stat"><div>Integrity</div><div id="hp">100%</div></div>
      <div class="stat"><div>Run Timer</div><div id="clock">00:00</div></div>
    </div>
    <div class="panel">
      <div class="stat"><div>Objective</div><div class="badge"><span>!</span> Open the Time Gate</div></div>
      <div class="controls">
        WASD to move, Arrow keys to rotate.<br />
        Press E near a terminal to answer.<br />
        Solve 3 terminals to unlock the portal.
      </div>
    </div>
    <div class="panel">
      <div class="stat"><div>Loadout</div><div class="badge"><span>&gt;</span> Debug Blaster</div></div>
      <div class="controls">
        You are not fighting creatures; you are fighting bugs.<br />
        Terminal correct answers lower security.
      </div>
    </div>
    <div class="panel">
      <div class="stack">
        <button id="startBtn" class="button">Start Run</button>
        <button id="resetBtn" class="button secondary">Reset</button>
      </div>
    </div>
  </aside>

  <section class="game">
    <div class="canvasWrap">
      <canvas id="view" width="900" height="520" aria-label="3D view"></canvas>
      <div class="hudTop">
        <div class="chip" id="locationChip">Sector 01</div>
        <div class="chip" id="hintChip">Find a terminal</div>
      </div>
      <div class="crosshair"></div>
      <div class="overlay" id="terminalOverlay" role="dialog" aria-modal="true" aria-label="Terminal Challenge">
        <div class="modal">
          <h2 id="terminalTitle">Terminal</h2>
          <div class="prompt" id="terminalPrompt"></div>
          <div class="code" id="terminalCode"></div>
          <div class="answers" id="terminalAnswers"></div>
          <div class="status" id="terminalStatus">Choose the correct output or fix.</div>
        </div>
      </div>
      <div class="overlay show" id="startOverlay" aria-label="Start Run">
        <div class="modal">
          <h2>Mission Briefing</h2>
          <div class="prompt">The vault is sealed by legacy code locks. Solve the coding terminals to unlock each door and reach the Time Gate.</div>
          <div class="status">Hit Start Run to begin. Stay on the move; the timer is always running.</div>
        </div>
      </div>
      <div class="overlay" id="winOverlay" aria-label="Mission Complete">
        <div class="modal">
          <h2>Portal Unlocked</h2>
          <div class="prompt win">You repaired the timeline by solving every terminal.</div>
          <div class="status">Reset to play again with shuffled challenges.</div>
        </div>
      </div>
    </div>
    <div class="footer">
      <div>Theme: Neon vault - Solve code to unlock doors</div>
      <div><strong>Tip:</strong> Stand close to the glowing panel and press E.</div>
    </div>
  </section>
</div>

<script>
const canvas = document.getElementById("view");
const ctx = canvas.getContext("2d");
const startBtn = document.getElementById("startBtn");
const resetBtn = document.getElementById("resetBtn");
const startOverlay = document.getElementById("startOverlay");
const winOverlay = document.getElementById("winOverlay");
const terminalOverlay = document.getElementById("terminalOverlay");
const terminalTitle = document.getElementById("terminalTitle");
const terminalPrompt = document.getElementById("terminalPrompt");
const terminalCode = document.getElementById("terminalCode");
const terminalAnswers = document.getElementById("terminalAnswers");
const terminalStatus = document.getElementById("terminalStatus");
const shardsEl = document.getElementById("shards");
const hpEl = document.getElementById("hp");
const clockEl = document.getElementById("clock");
const hintChip = document.getElementById("hintChip");

const map = [
  [1,1,1,1,1,1,1,1,1,1,1],
  [1,0,0,0,0,0,0,0,2,0,1],
  [1,0,1,1,0,1,1,0,1,0,1],
  [1,0,1,0,0,0,1,0,1,0,1],
  [1,0,1,0,1,0,1,0,0,0,1],
  [1,0,0,0,1,0,0,0,1,0,1],
  [1,0,1,0,1,1,1,0,1,0,1],
  [1,0,1,0,0,0,0,0,1,0,1],
  [1,0,0,0,1,1,1,0,0,3,1],
  [1,2,1,0,0,0,0,0,1,0,1],
  [1,1,1,1,1,1,1,1,1,1,1]
];

const doors = [
  {id:0, x:8, y:1, open:false},
  {id:1, x:1, y:9, open:false},
  {id:2, x:9, y:8, open:false}
];

const terminals = [
  {
    id:0,
    x:4.5,
    y:1.5,
    title:"Terminal 01: Output Trace",
    prompt:"What does this C# snippet print?",
    code:'int total = 0;\\nfor (int i = 1; i <= 3; i++) {\\n  total += i;\\n}\\nConsole.WriteLine(total);',
    options:["3","6","9","12"],
    answer:1
  },
  {
    id:1,
    x:2.5,
    y:7.5,
    title:"Terminal 02: Fix the Bug",
    prompt:"Choose the fix that prevents a null reference.",
    code:'string name = null;\\nif (name.Length > 0) {\\n  Console.WriteLine(name);\\n}',
    options:[
      "Check name != null before name.Length",
      "Replace name.Length with name.Count()",
      "Set name = name.Trim()",
      "Remove the if statement"
    ],
    answer:0
  },
  {
    id:2,
    x:7.5,
    y:5.5,
    title:"Terminal 03: Logic Gate",
    prompt:"Which option makes this function return true only for even numbers?",
    code:'bool IsEven(int n) {\\n  return ____;\\n}',
    options:[
      "n / 2 == 0",
      "n % 2 == 0",
      "n % 2 != 0",
      "n * 2 == 0"
    ],
    answer:1
  }
];

const state = {
  x:2.5,
  y:2.5,
  angle:0,
  moveSpeed:0.04,
  rotSpeed:0.045,
  keys:{},
  shards:0,
  hp:100,
  running:false,
  paused:false,
  timer:0,
  activeTerminal:null,
  win:false
};

function resizeCanvas(){
  const rect = canvas.getBoundingClientRect();
  canvas.width = Math.floor(rect.width * window.devicePixelRatio);
  canvas.height = Math.floor(rect.height * window.devicePixelRatio);
}

function pad(num){
  return String(num).padStart(2,"0");
}

function updateClock(){
  const mins = Math.floor(state.timer / 60);
  const secs = Math.floor(state.timer % 60);
  clockEl.textContent = `${pad(mins)}:${pad(secs)}`;
}

function startRun(){
  state.running = true;
  state.paused = false;
  startOverlay.classList.remove("show");
  hintChip.textContent = "Find a glowing terminal";
}

function resetRun(){
  state.x = 2.5;
  state.y = 2.5;
  state.angle = 0;
  state.shards = 0;
  state.hp = 100;
  state.timer = 0;
  state.running = false;
  state.paused = false;
  state.win = false;
  terminals.forEach(t => t.solved = false);
  doors.forEach(d => {d.open = false; map[d.y][d.x] = 2;});
  map[8][9] = 3;
  startOverlay.classList.add("show");
  winOverlay.classList.remove("show");
  terminalOverlay.classList.remove("show");
  updateHud();
}

function updateHud(){
  shardsEl.textContent = `${state.shards} / 3`;
  hpEl.textContent = `${state.hp}%`;
  updateClock();
}

function distance(a,b,c,d){
  return Math.hypot(a - c, b - d);
}

function nearestTerminal(){
  let nearest = null;
  let bestDist = 1.2;
  terminals.forEach(term => {
    if (term.solved) return;
    const dist = distance(state.x, state.y, term.x, term.y);
    if (dist < bestDist) {
      bestDist = dist;
      nearest = term;
    }
  });
  return nearest;
}

function openTerminal(term){
  state.activeTerminal = term;
  state.paused = true;
  terminalTitle.textContent = term.title;
  terminalPrompt.textContent = term.prompt;
  terminalCode.textContent = term.code;
  terminalStatus.textContent = "Choose the correct answer.";
  terminalAnswers.innerHTML = "";
  term.options.forEach((opt, idx) => {
    const btn = document.createElement("button");
    btn.className = "answer";
    btn.textContent = opt;
    btn.addEventListener("click", () => selectAnswer(idx));
    terminalAnswers.appendChild(btn);
  });
  terminalOverlay.classList.add("show");
}

function selectAnswer(idx){
  const term = state.activeTerminal;
  if (!term) return;
  const buttons = terminalAnswers.querySelectorAll(".answer");
  buttons.forEach((btn, i) => {
    if (i === term.answer) btn.classList.add("correct");
    if (i === idx && idx !== term.answer) btn.classList.add("wrong");
    btn.disabled = true;
  });
  if (idx === term.answer) {
    terminalStatus.textContent = "Access granted. Door unlocked.";
    term.solved = true;
    state.shards += 1;
    const door = doors.find(d => d.id === term.id);
    if (door) {
      door.open = true;
      map[door.y][door.x] = 0;
    }
    if (state.shards === 3) {
      hintChip.textContent = "All shards collected. Reach the Time Gate.";
      map[8][9] = 3;
    }
  } else {
    terminalStatus.textContent = "Access denied. Integrity -10.";
    state.hp = Math.max(0, state.hp - 10);
  }
  updateHud();
  setTimeout(() => {
    terminalOverlay.classList.remove("show");
    state.activeTerminal = null;
    state.paused = false;
  }, 900);
}

function isWall(x,y){
  const mx = Math.floor(x);
  const my = Math.floor(y);
  if (my < 0 || my >= map.length || mx < 0 || mx >= map[0].length) return true;
  return map[my][mx] !== 0;
}

function render(){
  const w = canvas.width;
  const h = canvas.height;
  ctx.clearRect(0,0,w,h);

  const skyGrad = ctx.createLinearGradient(0,0,0,h);
  skyGrad.addColorStop(0,"#0f1b33");
  skyGrad.addColorStop(0.45,"#11182a");
  skyGrad.addColorStop(1,"#080b13");
  ctx.fillStyle = skyGrad;
  ctx.fillRect(0,0,w,h);

  const fov = Math.PI / 3;
  const rays = w;
  for (let i = 0; i < rays; i++) {
    const rayAngle = (state.angle - fov/2) + (i / rays) * fov;
    const sin = Math.sin(rayAngle);
    const cos = Math.cos(rayAngle);
    let dist = 0;
    let hit = 0;
    while (dist < 16 && hit === 0) {
      dist += 0.02;
      const testX = state.x + cos * dist;
      const testY = state.y + sin * dist;
      if (testY < 0 || testY >= map.length || testX < 0 || testX >= map[0].length) {
        hit = 1;
        dist = 16;
      } else if (map[Math.floor(testY)][Math.floor(testX)] !== 0) {
        hit = map[Math.floor(testY)][Math.floor(testX)];
      }
    }
    const corrected = dist * Math.cos(rayAngle - state.angle);
    const wallHeight = Math.min(h, h / (corrected + 0.0001));
    const wallTop = (h - wallHeight) / 2;

    let base = "#1e293b";
    if (hit === 2) base = "#f97316";
    if (hit === 3) base = "#22c55e";
    const shade = Math.max(0.15, 1 - corrected / 10);
    ctx.fillStyle = shadeColor(base, shade);
    ctx.fillRect(i, wallTop, 1, wallHeight);
  }

  drawFloorGlow(w, h);
  drawTerminalsHint();
}

function drawFloorGlow(w,h){
  const grad = ctx.createRadialGradient(w*0.5,h*0.8,10,w*0.5,h*0.8,h*0.7);
  grad.addColorStop(0,"rgba(45,212,191,0.12)");
  grad.addColorStop(1,"rgba(8,12,18,0)");
  ctx.fillStyle = grad;
  ctx.fillRect(0,0,w,h);
}

function drawTerminalsHint(){
  const term = nearestTerminal();
  if (!term || !state.running) return;
  const dist = distance(state.x, state.y, term.x, term.y);
  if (dist < 1.2) {
    hintChip.textContent = "Terminal in range. Press E.";
  } else if (state.shards < 3) {
    hintChip.textContent = "Find a glowing terminal";
  }
}

function shadeColor(hex, light){
  const num = parseInt(hex.replace("#",""),16);
  const r = Math.min(255, Math.floor(((num >> 16) & 255) * light));
  const g = Math.min(255, Math.floor(((num >> 8) & 255) * light));
  const b = Math.min(255, Math.floor((num & 255) * light));
  return `rgb(${r},${g},${b})`;
}

function update(){
  if (!state.running || state.win || state.paused) {
    render();
    requestAnimationFrame(update);
    return;
  }
  const forwardX = Math.cos(state.angle);
  const forwardY = Math.sin(state.angle);
  const rightX = Math.cos(state.angle + Math.PI/2);
  const rightY = Math.sin(state.angle + Math.PI/2);

  if (state.keys["ArrowLeft"]) state.angle -= state.rotSpeed;
  if (state.keys["ArrowRight"]) state.angle += state.rotSpeed;
  let nextX = state.x;
  let nextY = state.y;
  if (state.keys["w"]) { nextX += forwardX * state.moveSpeed; nextY += forwardY * state.moveSpeed; }
  if (state.keys["s"]) { nextX -= forwardX * state.moveSpeed; nextY -= forwardY * state.moveSpeed; }
  if (state.keys["a"]) { nextX -= rightX * state.moveSpeed; nextY -= rightY * state.moveSpeed; }
  if (state.keys["d"]) { nextX += rightX * state.moveSpeed; nextY += rightY * state.moveSpeed; }

  if (!isWall(nextX, state.y)) state.x = nextX;
  if (!isWall(state.x, nextY)) state.y = nextY;

  state.timer += 1/60;
  updateHud();
  checkExit();
  render();
  requestAnimationFrame(update);
}

function checkExit(){
  const exitDist = distance(state.x, state.y, 9.5, 8.5);
  if (state.shards === 3 && exitDist < 0.8) {
    state.win = true;
    winOverlay.classList.add("show");
    hintChip.textContent = "Run complete";
  }
}

window.addEventListener("keydown", (e) => {
  const key = e.key.toLowerCase();
  state.keys[key] = true;
  if (key === "e" && state.running && !state.activeTerminal) {
    const term = nearestTerminal();
    if (term) openTerminal(term);
  }
});
window.addEventListener("keyup", (e) => {
  state.keys[e.key.toLowerCase()] = false;
});

startBtn.addEventListener("click", startRun);
resetBtn.addEventListener("click", resetRun);

window.addEventListener("resize", resizeCanvas);
resizeCanvas();
resetRun();
update();
</script>
</body>
</html>
